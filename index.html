<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>転倒リスク・身体機能評価システム | Rehaence</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #f8f9fa; font-family: "Helvetica Neue", Arial, sans-serif; color: #333; }
        .container { max-width: 1100px; background: white; padding: 40px; margin-top: 30px; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .card-header { font-weight: bold; background-color: #2c3e50 !important; color: white !important; }
        .result-box { padding: 20px; border-radius: 6px; border: 1px solid #dee2e6; background-color: #e9ecef; margin-bottom: 20px; }
        .guide-section { background-color: #fff; padding: 25px; border-radius: 6px; border: 1px solid #e9ecef; margin-top: 50px; }
        .developer-message { background-color: #f8f9fa; border-left: 5px solid #2c3e50; padding: 25px; margin-top: 50px; }
        .legal-footer { font-size: 0.8rem; color: #6c757d; background: #f8f9fa; padding: 30px; margin-top: 50px; border-top: 1px solid #dee2e6; }
        @media print { .no-print { display: none !important; } body { background-color: white; -webkit-print-color-adjust: exact; } .container { box-shadow: none; margin: 0; padding: 0; max-width: 100%; width: 100%; } }
    </style>
</head>
<body>

<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h2 class="fw-bold text-dark mb-0"><i class="bi bi-clipboard-data"></i> 身体機能評価レポート</h2>
            <small class="text-muted">Physical Function Assessment System (2026 Edition)</small>
        </div>
        <button onclick="window.print()" class="btn btn-outline-dark btn-sm no-print"><i class="bi bi-printer"></i> レポート印刷</button>
    </div>

    <div class="row g-5">
        <div class="col-md-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header">測定データ入力</div>
                <div class="card-body">
                    <h6 class="fw-bold border-bottom pb-2 mb-3">基本情報</h6>
                    <div class="row g-2 mb-4">
                        <div class="col-6"><label class="small fw-bold">年齢</label><input type="number" id="age" class="form-control" value="70"></div>
                        <div class="col-6"><label class="small fw-bold">性別</label><select id="gender" class="form-select"><option value="female">女性</option><option value="male">男性</option></select></div>
                        <div class="col-6"><label class="small fw-bold">身長 (cm)</label><input type="number" id="height" class="form-control"></div>
                        <div class="col-6"><label class="small fw-bold">体重 (kg)</label><input type="number" id="weight" class="form-control"></div>
                    </div>
                    <h6 class="fw-bold border-bottom pb-2 mb-3">測定値</h6>
                    <table class="table table-sm align-middle small">
                        <tbody id="input-table-body"></tbody>
                    </table>
                    <button class="btn btn-dark w-100 mt-4 py-3 fw-bold shadow-sm no-print" onclick="analyze()">アセスメントを実行</button>
                </div>
            </div>
        </div>
        <div class="col-md-8">
            <div id="resBox" class="result-box text-center"><h5 class="fw-bold text-secondary my-2">データを入力してください</h5></div>
            <div id="bmiBox" class="mb-3 text-center"></div>
            <div class="chart-container" style="height: 400px; position: relative;"><canvas id="mainChart"></canvas></div>
            <div id="detailArea" class="mt-4" style="display:none;">
                <table class="table table-bordered table-striped small text-center"><thead class="table-dark"><tr><th>項目</th><th>実数値</th><th>平均値</th><th>判定</th></tr></thead><tbody id="detailBody"></tbody></table>
            </div>
        </div>
    </div>

    <div class="guide-section mt-4">
        <h4 class="fw-bold border-bottom pb-3 mb-4">測定マニュアル・実施基準</h4>
        <div class="row g-4">
            <div class="col-md-4"><h6>TUG</h6><p class="small">13.5秒以上で転倒リスク増</p></div>
            <div class="col-md-4"><h6>下腿周径</h6><p class="small">男性34cm/女性33cm未満</p></div>
            <div class="col-md-4"><h6>5回立ち上がり</h6><p class="small">12秒以上で機能低下</p></div>
        </div>
    </div>

    <div class="guide-section mt-5 no-print">
        <h4 class="fw-bold border-bottom pb-3 mb-4">リハビリテーションコラム</h4>
        <p class="small text-secondary">1. 数値化の重要性 2. TUGの臨界点 3. フレイル予防</p>
    </div>

    <footer class="legal-footer no-print">
        <div class="row">
            <div class="col-md-6">
                <h6>免責事項・データソース</h6>
                <p>本システムは公開統計データに基づき可視化するもので、診断を行う医療機器ではありません。</p>
                <small>出典：厚生労働省「2025年度 国民健康・栄養調査結果」および日本老年医学会ガイドライン</small>
            </div>
            <div class="col-md-6 border-start ps-md-5 mt-4 mt-md-0">
                <h6>運営情報</h6>
                <p class="small">Rehaenceプロジェクト | rehaence1@gmail.com | Google AdSense/Cookie使用</p>
                <a href="privacy.html" class="btn btn-link btn-sm p-0">プライバシーポリシー</a>
            </div>
        </div>
    </footer>
</div>

<script>
    const REHA_STATS = {
        male: { "U40": { grip:46.5, calf:36.8, one_leg:60.0, five_stand:6.2, tug:6.8, walk:6.2 }, "40-59": { grip:43.2, calf:35.5, one_leg:55.0, five_stand:7.1, tug:7.5, walk:7.0 }, "60-69": { grip:38.5, calf:34.8, one_leg:40.0, five_stand:8.2, tug:8.4, walk:7.8 }, "70-79": { grip:33.4, calf:33.5, one_leg:22.0, five_stand:9.8, tug:9.5, walk:8.8 }, "80+": { grip:26.1, calf:32.2, one_leg:10.0, five_stand:12.5, tug:11.8, walk:10.5 } },
        female: { "U40": { grip:28.5, calf:34.2, one_leg:60.0, five_stand:6.5, tug:7.2, walk:6.8 }, "40-59": { grip:27.2, calf:33.5, one_leg:50.0, five_stand:7.5, tug:7.8, walk:7.5 }, "60-69": { grip:24.8, calf:32.8, one_leg:35.0, five_stand:8.8, tug:8.9, walk:8.2 }, "70-79": { grip:21.2, calf:31.8, one_leg:18.0, five_stand:10.5, tug:10.2, walk:9.5 }, "80+": { grip:16.5, calf:30.5, one_leg:8.0, five_stand:13.8, tug:12.5, walk:11.2 } }
    };
    const items = [
        {id:'grip', label:'握力', unit:'kg', lowBetter:false, cutOff:null},
        {id:'calf', label:'下腿周径', unit:'cm', lowBetter:false, cutOff:{male:34, female:33}},
        {id:'one_leg', label:'片脚立位', unit:'秒', lowBetter:false, cutOff:15},
        {id:'five_stand', label:'5回立ち', unit:'秒', lowBetter:true, cutOff:12},
        {id:'tug', label:'TUG', unit:'秒', lowBetter:true, cutOff:13.5},
        {id:'walk', label:'10m歩行', unit:'秒', lowBetter:true, cutOff:10}
    ];
    let chartInstance = null;
    const tbody = document.getElementById('input-table-body');
    items.forEach(i => { tbody.innerHTML += `<tr><td>${i.label}</td><td><input type="number" id="curr_${i.id}" class="form-control form-control-sm"></td></tr>`; });
    function analyze() {
        const age = parseInt(document.getElementById('age').value);
        const gender = document.getElementById('gender').value;
        const grp = age<40?"U40":age<60?"40-59":age<70?"60-69":age<80?"70-79":"80+";
        const ref = REHA_STATS[gender][grp];
        const data = items.map(item => {
            const val = parseFloat(document.getElementById('curr_'+item.id).value) || null;
            const avg = ref[item.id];
            let status = 'avg';
            const cut = (typeof item.cutOff === 'object' && item.cutOff !== null) ? item.cutOff[gender] : item.cutOff;
            if(val) status = cut ? (item.lowBetter ? (val >= cut ? 'caution' : 'good') : (val < cut ? 'caution' : 'good')) : (item.lowBetter ? (val <= avg ? 'good' : 'caution') : (val >= avg ? 'good' : 'caution'));
            return { label:item.label, val, avg, unit:item.unit, status, lowBetter:item.lowBetter };
        });
        updateChart(data);
        updateDetailTable(data);
    }
    function updateChart(data) {
        const ctx = document.getElementById('mainChart').getContext('2d');
        if (chartInstance) chartInstance.destroy();
        chartInstance = new Chart(ctx, { type:'radar', data:{ labels:data.map(d=>d.label), datasets:[{ label:'比較(%)', data:data.map(d=>d.val?(d.lowBetter?(d.avg/d.val)*100:(d.val/d.avg)*100):0), backgroundColor:'rgba(44,62,80,0.2)', borderColor:'#2c3e50' }] }, options:{ scales:{ r:{ suggestedMin:0, suggestedMax:140 } } } });
    }
    function updateDetailTable(data) {
        const tbodyRes = document.getElementById('detailBody');
        tbodyRes.innerHTML = ""; document.getElementById('detailArea').style.display = "block";
        data.forEach(d => { tbodyRes.innerHTML += `<tr><td>${d.label}</td><td>${d.val||'-'}</td><td>${d.avg}</td><td><span class="badge ${d.status==='good'?'bg-primary':(d.status==='caution'?'bg-danger':'bg-secondary')}">${d.status==='good'?'良好':(d.status==='caution'?'注意':'平均')}</span></td></tr>`; });
    }
</script>
</body>
</html>
